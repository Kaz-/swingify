<ng-container *ngIf="(playlist$ | async); then playlist; else selection"></ng-container>
<ng-template #playlist>
  <div class="header" *ngIf="playlist$ | async as playlist">
    <a href="{{ playlist?.external_urls.spotify }}" target="_blank">
      <swg-playlist-image [playlist]="playlist"></swg-playlist-image>
      <div>
        <h3>{{ playlist?.name }}</h3>
        <small>By {{ playlist?.owner.display_name }}</small>
      </div>
    </a>
    <div *ngIf="tracks$ | async as tracks">
      <span class="total">{{ tracks?.items.length }} of {{ tracks?.total }} tracks</span>
      <button class="primary-button" [title]="isSecondary ? 'Remove all tracks' : 'Export all tracks'"
        (click)="execute(true)">
        <i class="icon {{ isSecondary ? 'minus' : 'plus' }}"></i>
      </button>
    </div>
  </div>
  <ng-container *ngIf="tracks$ | async as tracks">
    <div class="field">
      <svg height="15" width="15" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16"
        role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor"
        d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg>
      <input class="search" type="text" [formControl]="searchControl" placeholder="Search for artists, tracks, albums...">
    </div>
    <div class="tracklist-wrapper" infiniteScroll [scrollWindow]="false" (scrolled)="onScroll(tracks)">
      <ul class="tracklist">
        <li class="track" *ngFor="let item of (tracks$ | async)?.items">
          <ng-container *ngIf="item.track?.album.images.length > 0; then image; else icon"></ng-container>
          <ng-template #image>
            <img class="track-image" [src]="item.track?.album.images[0].url">
          </ng-template>
          <ng-template #icon>
            <i class="icon music"></i>
          </ng-template>
          <a class="track-informations" [href]="item.track?.external_urls.spotify" target="_blank">
            <div class="wrapper">
              <div class="name" [title]="item.track?.name">{{ item.track?.name }}</div>
              <div class="from" title="{{ item.track?.artists[0]?.name }} · {{ item.track?.album.name }}">
                {{ item.track?.artists[0]?.name }} ·	{{ item.track?.album.name }}
              </div>
            </div>
            <span class="track-duration">{{ toDuration(item.track?.duration_ms) }}</span>
          </a>
          <button class="{{ isSecondary ? 'red' : 'green' }}-button" [title]="isSecondary ? 'Remove' : 'Export'"
            (click)="execute(false, item.track?.uri)">
            <i class="icon {{ isSecondary ? 'minus' : 'plus' }}"></i>
          </button>
        </li>
      </ul>
    </div>
  </ng-container>
</ng-template>
<ng-template #selection>
  <swg-playlists title="Playlists" [allowCreation]="true" [user$]="user$" [playlists$]="playlists$" [isSecondary]="isSecondary"></swg-playlists>
</ng-template>
